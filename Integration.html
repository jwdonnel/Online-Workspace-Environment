<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Integrating with the OpenWSE</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link id="Link1" runat="server" rel="shortcut icon" href="Standard_Images/favicon.ico"
        type="image/x-icon" />
    <link id="Link2" runat="server" rel="icon" href="Standard_Images/favicon.ico" type="image/ico" />
    <link href="App_Themes/Standard/site_desktop.css" rel="stylesheet" type="text/css" />
    <link href="App_Themes/Standard/jqueryUI.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .integration-part h2
        {
            font-weight: bold;
            clear: both;
            padding-bottom: 10px;
        }

        .integration-part
        {
            margin-bottom: 70px;
        }

        .sample-code
        {
            padding: 10px 0;
        }

            .sample-code h4
            {
                clear: both;
                padding-bottom: 5px;
            }
    </style>
</head>
<body>
    <div class="stylefour">
        <span>OpenWSE Code Integration</span>
    </div>
    <div class="clear" style="height: 50px;">
    </div>
    <div class="pad-all-big">
        <h4>The OpenWSE allows you to integrate your own code with this platform. Currently there are only 4 types to integrate with the openWSE.<br />
            This uses C# .Net 4.0 and users integrating with this will need some basic knowledge of coding.<br />
            To use the OpenWSE classes, you need to add App_Code.dll to your project. This dll file can be found in the Bin directory of the site.
        </h4>
        <div class="clear-space">
        </div>
        <div id="accordion">
            <div class="editor_titles">
                <div class="title-line"></div>
                <h3>Notification System</h3>
            </div>
            <div class="clear-space"></div>
            <div class="integration-part">
                The notification system allows you to notify users of any updates from a given app. There are 3 classes that you will need to call in order to successfully integrate the notification system.
                <br />
                <br />
                <img alt="" src="Standard_Images/Integration/notification-2.png" />
                <div class="clear-space"></div>
                <div id="code1" class="code" data-mode="csharp">
                    using OpenWSE_Tools.Notifications;

                    /// &lt;summary&gt;
                    /// This initializes the UserNotificationMessages class which you will need to call the method attemptAdd
                    /// &lt;/summary&gt;
                    /// &lt;param name="username">The username of the current user&lt;/param&gt;
                    public UserNotificationMessages(string username)
                </div>
                <div class="clear-space"></div>
                <div id="code2" class="code" data-mode="csharp">
                    /// &lt;summary&gt;
                    /// Determine if a notification can be logged in for a user
                    /// &lt;/summary&gt;
                    /// &lt;param name="appId"&gt;The app id that the notification needs to identify with&lt;/param&gt;
                    /// &lt;param name="message"&gt;Message to post&lt;/param&gt;
                    /// &lt;param name="addFlag"&gt;Add the flag for the Auto Update System&lt;/param&gt;
                    /// &lt;param name="date"&gt;Date posted - Defaults to current date&lt;/param&gt;
                    /// &lt;returns&gt;The email address of the current user&lt;/returns&gt;
                    public string attemptAdd(string appId, string message, bool addFlag, string date = "")
                </div>
                <div class="clear-space"></div>
                <div id="code3" class="code" data-mode="csharp">
                    /// &lt;summary&gt;
                    /// Finish adding all the notifications to all the users in the mailTo list
                    /// &lt;/summary&gt;
                    /// &lt;param name="mailTo"&gt;MailMessage list&lt;/param&gt;
                    /// &lt;param name="appId"&gt;App Id to associate notification with&lt;/param&gt;
                    /// &lt;param name="message"&gt;Message body to post&lt;/param&gt;
                    /// &lt;param name="subject"&gt;The subject or title of the notification&lt;/param&gt;
                    public static void finishAdd(MailMessage mailTo, string appId, string message, string subject = "")
                </div>
                <div class="clear-space"></div>
                <div class="sample-code">
                    <h4 class="font-bold">Sample Code</h4>
                    <h4>This is a simple integration that sends every user in the database a notification if enabled</h4>
                    <div id="code4" class="code" data-mode="csharp">
                        private void AddNotifications() {
                        &nbsp;&nbsp;&nbsp;// Call the list of users in the database
                        &nbsp;&nbsp;&nbsp;MembershipUserCollection userlist = Membership.GetAllUsers();

                        &nbsp;&nbsp;&nbsp;// You will need to specify the app id that the notification is being sent from.
                        &nbsp;&nbsp;&nbsp;string app_id = "app-messageboard";

                        &nbsp;&nbsp;&nbsp;string messagebody = "OpenWSE Integration Notification.";

                        &nbsp;&nbsp;&nbsp;// Initialize the MailMessage
                        &nbsp;&nbsp;&nbsp;var message = new MailMessage();

                        &nbsp;&nbsp;&nbsp;foreach (MembershipUser u in userlist) {
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create a new UserNotificationMessage for the current user in the list
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserNotificationMessages un = new UserNotificationMessages(u.UserName);
                        
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// The attemptAdd will determine if the user has the email notification enabled and if so,
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// will return the email address of that user.
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string email = un.attemptAdd(app_id, messagebody, true);
                        
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add the email to the MailMessage list
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!string.IsNullOrEmpty(email)) {
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message.To.Add(email);
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
                        &nbsp;&nbsp;&nbsp;}

                        &nbsp;&nbsp;&nbsp;// Add, notify, and email all users in the message list
                        &nbsp;&nbsp;&nbsp;UserNotificationMessages.finishAdd(message, app_id, messagebody);
                        }
                    </div>
                </div>
                <div class="clear-space"></div>
                <h4>Once you have successfully created your methods for adding notifications, navigate to the Notification Manager under the Settings/Tools tab on the left sidebar.<br />
                    In order for the app to post the notification, you will need to add it to the list of notifications. Simply give the notification any name, icon (Or use app icon), description, and select the app to associate with. You can have more than 1 app associated with a notification.<br />
                    <img alt="" src="Standard_Images/Integration/notification-1.png" />
                    <div class="clear-space"></div>
                </h4>
            </div>
            <div class="editor_titles">
                <div class="title-line"></div>
                <h3>Auto Update System</h3>
            </div>
            <div class="clear-space"></div>
            <div class="integration-part">
                The Auto Update system allows you to automatically update a app or the workspace immediately.
                <br />
                <br />
                <div id="code5" class="code" data-mode="csharp">
                    using OpenWSE_Tools.AutoUpdates;

                    // This initializes the UserUpdateFlags class which you will need to call the method addFlag
                    UserUpdateFlags _uuf = new UserUpdateFlags();
                </div>
                <div class="clear-space"></div>
                <div id="code6" class="code" data-mode="csharp">
                    /// &lt;summary&gt;
                    /// Adds a flag to the given user to update their current state
                    /// &lt;/summary&gt;
                    /// &lt;param name="username"&gt;&lt;/param&gt;
                    /// &lt;param name="appID"&gt;The app to update. Use "workspace" to update everything.&lt;/param&gt;
                    /// &lt;param name="groupname"&gt;The groupname. Leave blank if none.&lt;/param&gt;
                    public void addFlag(string username, string appID, string groupname)
                </div>
                <div class="clear-space"></div>
                <div id="code7" class="code" data-mode="csharp">
                    /// &lt;summary&gt;
                    /// Updates all users with the given app and groupname
                    /// &lt;/summary&gt;
                    /// &lt;param name="appID"&gt;The app to update. Use "workspace" to update everything.&lt;/param&gt;
                    /// &lt;param name="groupname"&gt;The groupname. Leave blank if none.&lt;/param&gt;
                    /// &lt;param name="updateForCurrUser"&gt;Update the current user&lt;/param&gt;
                    public void addFlag(string appID, string groupname, bool updateForCurrUser = true)
                </div>
                <div class="clear-space"></div>
                <div id="code8" class="code" data-mode="csharp">
                    /// &lt;summary&gt;
                    /// Gets the update flag for the given user for the workspace
                    /// &lt;/summary&gt;
                    /// &lt;param name="username"&gt;Any given user in the database&lt;/param&gt;
                    /// &lt;returns&gt;&lt;/returns&gt;
                    public string getFlag(string username)
                </div>
                <div class="clear-space"></div>
                <div id="code9" class="code" data-mode="csharp">
                    /// &lt;summary&gt;
                    /// Gets the update flag for the given user for a app
                    /// &lt;/summary&gt;
                    /// &lt;param name="username"&gt;Any given user in the database&lt;/param&gt;
                    /// &lt;param name="appID"&gt;The app to update. Use "workspace" to update everything.&lt;/param&gt;
                    /// &lt;returns&gt;&lt;/returns&gt;
                    public string getFlag(string username, string appID)
                </div>
                <div class="clear-space"></div>
                <div id="code10" class="code" data-mode="csharp">
                    /// &lt;summary&gt;
                    /// Gets the update flag for the given user on a given workspace for a given group
                    /// &lt;/summary&gt;
                    /// &lt;param name="username"&gt;Any given user in the database&lt;/param&gt;
                    /// &lt;param name="appID"&gt;The app to update. Use "workspace" to update everything.&lt;/param&gt;
                    /// &lt;param name="groupname"&gt;The groupname. Leave blank if none.&lt;/param&gt;
                    /// &lt;returns&gt;&lt;/returns&gt;
                    public string getFlag(string username, string appID, string groupname)
                </div>
            </div>
            <div class="editor_titles">
                <div class="title-line"></div>
                <h3>Overlays</h3>
            </div>
            <div class="clear-space"></div>
            <div class="integration-part">
                Creating an overlay is a very simple process. All overlays will need to be created as a User Control (.ascx).
                <div class="clear-space"></div>
                <div class="sample-code">
                    <h4 class="font-bold">Sample Code</h4>
                    <h4>This is a simple example using the Rss News Feed Overlay.</h4>
                    <div id="code11" class="code" data-mode="html">
                        &lt;div id="RSSFeed_Overlay_Position" runat="server" class="rss-feed-workspace"&gt;
                        &nbsp;&nbsp;&nbsp;&lt;asp:Panel ID="rssfeeds_pnl_entries" runat="server" CssClass="overlay-entries rss-feed-pnl-entries"&gt;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div class="font-color-light-black pad-all"&gt;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;small&gt;&lt;i&gt;If overlay fails to load, refresh the page&lt;/i&gt;&lt;/small&gt;&lt;/div&gt;
                        &nbsp;&nbsp;&nbsp;&lt;/asp:Panel&gt;
                        &lt;/div&gt;
                    </div>
                    <div class="clear-space"></div>
                    <h4>When creating the main div of the overlay, make sure you give it a unique Id and set the runat to server.</h4>
                    <div class="clear-space"></div>
                    <h4 class="font-bold">Sample Code</h4>
                    <h4>In the .ascx.cs file of your overlay, make sure you create these private variables at the top before the Page_Load.</h4>
                    <div id="code12" class="code" data-mode="csharp">
                        private OverlayInitializer _overlayInit;
                    </div>
                    <div class="clear-space"></div>
                    <h4>In the Page_Load method, create a new instance of the _overlayInit.</h4>
                    <div id="code13" class="code" data-mode="csharp">
                        protected void Page_Load(object sender, EventArgs e) {
                        &nbsp;&nbsp;&nbsp;_overlayInit = new OverlayInitializer(string.Empty, "Overlays/RSSFeed_Overlay.ascx");
                        &nbsp;&nbsp;&nbsp;if (_overlayInit.TryLoadOverlay) {
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadOverlay();
                        &nbsp;&nbsp;&nbsp;}
                        }

                        private void LoadOverlay() {
                        &nbsp;&nbsp;&nbsp;AppInitializer _appInitializer = new AppInitializer("app-rssfeed", string.Empty, Page);
                        &nbsp;&nbsp;&nbsp;_appInitializer.LoadScripts_JS(true, "StartRSSFeederOverlay()");
                        }
                    </div>
                    <div class="clear-space"></div>
                    <h4>Once you have the overlay completed, you are ready to upload it to the Overlay Manager. Navigate to the Overlay Manager under the Settings/Tools tab in the left sidebar.</h4>
                    <img alt="" src="Standard_Images/Integration/overlay-1.png" />
                </div>
            </div>
            <div class="editor_titles">
                <div class="title-line"></div>
                <h3>Apps</h3>
            </div>
            <div class="clear-space"></div>
            <div class="integration-part">
                There are a couple of different ways to create a app. The first is to use the Create App feature under the App Editor. Creating a app through the site is for more simple apps, ones that don't need any major code in the backend.<br />
                The best way to do it is to create a new User Control (.ascx) or a new website under Microsoft Visual Studio or equivalent. There are a few css classes you will need to know before beginning creating your app:
                    <br />
                <br />
                <b>The css class below is for the main div of the app:</b>
                <div id="code14" class="code" data-mode="css">
                    .main-div-app-bg{background:#FFF;overflow:auto;position:absolute;right:0px;left:0px;top:0px;bottom:0px;z-index:0;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px}
                </div>
                <br />
                <br />
                <b>The css classes below are for any modal windows within a User Control style app:</b>
                <div id="code15" class="code" data-mode="css">
                    .outside-main-app-div { /* Used for jquery */ }
                </div>
                <br />
                <br />
                <b>Sample C# Code for initializing the App - Message Board</b>
                <div id="code16" class="code" data-mode="csharp">
                    private readonly App _apps = new App();
                    private AppInitializer _appInitializer;
                    private const string app_id = "app-messageboard";

                    protected void Page_Load(object sender, EventArgs e) {
                    &nbsp;&nbsp;&nbsp;_appInitializer = new AppInitializer(app_id, Page.User.Identity.Name, Page);
                    &nbsp;&nbsp;&nbsp;_appInitializer.LoadScripts_JS(true, "StartMessageBoard();LoadMessageBoardPosts()");

                    &nbsp;&nbsp;&nbsp;string script = "openWSE.GetScriptFunction('//tinymce.cachefly.net/4.1/tinymce.min.js', function() { LoadTinyMCEControls_Simple(); $('#Editor_messageboard_ifr').tooltip({ disabled: true }); });";
                    &nbsp;&nbsp;&nbsp;ScriptManager.RegisterStartupScript(this, GetType(), Guid.NewGuid().ToString(), script, true);
                    }
                </div>
                <div class="clear-space"></div>
                When uploading a new app, use the Upload App feature under the App Editor. You can upload a zip file that contains all your code and dlls.<br />
            </div>
        </div>
    </div>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
    <script type="text/javascript" src="Scripts/AceEditor/ace.js" charset="utf-8"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".code").each(function () {
                var id = $(this).attr("id");
                if (id != "") {
                    var mode = $(this).attr("data-mode");
                    if (mode == "") {
                        mode = "csharp";
                    }

                    var text = "";
                    var lines = $(this).html().split("\n");
                    for (var i = 0; i < lines.length; i++) {
                        var tempText = $.trim(lines[i]);
                        if (tempText == "" && i == 0) {
                            continue;
                        }

                        tempText = tempText.replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&nbsp;/g, " ");
                        text += tempText;
                        if (i < lines.length - 2) {
                            text += "\n";
                        }
                    }

                    LoadAceEditor(id, text, mode);
                }
            });
        });

        function LoadAceEditor(id, text, mode) {
            var path = "Scripts/AceEditor";
            ace.config.set("workerPath", path);
            var editor = ace.edit(id);
            editor.setReadOnly(true);
            editor.setTheme('ace/theme/chrome');
            editor.getSession().setMode("ace/mode/" + mode);
            editor.getSession().setUseWrapMode(false);
            editor.setShowPrintMargin(false);
            editor.getSession().setValue(text);
            var totalLines = editor.getSession().getLength();
            $("#" + id).css("height", totalLines * 14);
            editor.resize();
        }
    </script>
</body>
</html>
