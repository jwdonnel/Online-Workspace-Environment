var chatClient = function () { function l() { r = h() + "ChatClient/ChatService.asmx" } function c(e) { var t = $.trim(e.toString().toLowerCase()); if (t != "true" && t != "false" && t != "0" && t != "1" && t != "") { return true } if (t == "1" || t == "true" || t == "") { return true } else if (t == "0" || t == "false") { return false } return false } function h() { if (typeof openWSE == "object" || typeof openWSE == "function") { return openWSE.siteRoot() } return "" } function p(e, t, n) { var r = openWSE.Getworkspace(); var i = "app-ChatClient-" + t; if ($(".app-main-holder[data-appid='" + i + "']").length == 0) { var s = $(".ChatUserNotSelected[chat-username='" + e + "']").find(".statusUserDiv").attr("class"); if (s != "" && s != null && s != undefined) { s = s.replace("statusUserDiv ", "") } var o = "<div data-appid='" + i + "' chat-username='" + e + "' class='app-main-holder app-main chat-modal' style='display: none; min-height: 425px; min-width: 315px;'>"; o += "<div class='app-head-button-holder'>"; o += "<a href='#" + i + "' class='options-button-app' title='View app options'></a>"; o += "<div class='app-popup-inner-app'>"; o += "<table><tbody><tr><td valign='top'><h3>App Options</h3><div class='clear-space-five'></div><ul>"; o += "<li onclick='openWSE.ReloadApp(this)' title='Refresh'><a href='#" + i + "' class='reload-button-app'></a>Refresh</li>"; o += "<li onclick=\"openWSE.PopOutFrame(this,'ExternalAppHolder.aspx?chatuser=" + e + "')" + "\" title='Pop Out'><a href='#" + i + "' class='popout-button-app'></a>Pop out</li>"; o += "<li onclick='openWSE.AboutApp(this)' title='About App'><div class='about-app'></div>About</li></ul></td></tr>"; if ($("#ddl_WorkspaceSelector").length > 0) { o += "<tr><td><div class='clear-space'></div><span class='workspace-selector-app-option'>Workspace</span>"; o += "<select class='app-options-workspace-switch'>"; var u = $("#ddl_WorkspaceSelector").find(".dropdown-db-selector").find(".workspace-selection-item").length; for (var a = 0; a < u; a++) { o += "<option value='" + (a + 1).toString() + "'>" + (a + 1).toString() + "</option>" } o += "</select></td></tr>" } o += "</tbody></table></div>"; o += "<a href='#" + i + "' class='exit-button-app' title='Close'></a>"; o += "<a href='#" + i + "' class='maximize-button-app' title='Maximize'></a>"; o += "<a href='#" + i + "' class='minimize-button-app' title='Minimize'></a></div>"; o += "<div class='app-head app-head-dblclick'>"; o += "<div class='app-header-icon statusUserDiv2 margin-right-sml " + s + "'></div>"; o += "<span class='app-title'>" + n + "</span></div><div class='app-body'></div></div>"; $("#MainContent_" + r).append(o) } if ($(".app-main-holder[data-appid='" + i + "']").length > 0) { openWSE.ApplyAppDragResize(); var f = $(".app-main-holder[data-appid='" + i + "']"); openWSE.LoadApp(f, r); if (f.hasClass("active") == false) { f.addClass("active") } S(e) } } function d(e) { $("#pnl_icons, #pnl_chat_users").hide(); $("#pnl_chat_popup").fadeIn(150); if ($(".iFrame-chat").length > 0) { $(".iFrame-chat").each(function () { $(this).remove() }) } $("#pnl_chat_popup").append("<iframe class='iFrame-chat' src='" + h() + "ChatClient/ChatWindow.html?user=" + e + "' width='100%' frameborder='0'></iframe>"); S(e); $(window).resize() } function v() { var e; e = $get("chattersOnline").innerHTML; return e } function m() { if (!o) { o = true; $.ajax({ type: "POST", url: r + "/CallUserList", data: '{ "currstatus": "' + $("#span_currStatus").html() + '","isPostBack": "' + i + '" }', contentType: "application/json; charset=utf-8", dataType: "json", cache: false, success: function (e) { if (e.d[0] != null) E(e.d[0]); if (e.d[1] != null) g(e.d[1]); if (e.d[2] != null) { y(e.d[2]) } i = 0; o = false; if (!s) { $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") } m() }, error: function (e) { i = 0; o = false; if (!s) { $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") } m() } }) } } function g(e) { if (document.getElementById("chatuserlist") == null) { return } var t = document.getElementById("chatuserlist").innerHTML; t = t.replace(/"/g, "'"); t = t.replace(/ ChatUserSelected/g, ""); t = t.replace(/ChatUserSelected /g, ""); t = t.replace(/ chatisNew/g, ""); t = t.replace(/chatisNew/g, ""); t = t.replace(/;/g, ""); t = t.replace(/%2F/g, ""); if (e != "" && e.toLowerCase() != t.toLowerCase()) { $("#chatuserlist").html(e); var n = $(".listofusers li").size(); var r = document.getElementById("chatusers_none"); if (n == "0" && (r == null || r == undefined)) { $("#header-total-online").html("0"); $("#chatuserlist").html("<div id='chatusers_none'>No users available</div>") } else { var i = document.getElementById("chatuserlist"); i.scrollTop = i.scrollHeight; var s = v(); if (s == "none") s = "no users "; $("#header-total-online").html(s); $(".chat-modal").each(function () { var e = $(this).attr("data-appid"); e = e.replace("app-ChatClient-", ""); var t = $(".ChatUserNotSelected").find("span[chat-userid='" + e + "']").parent().find(".statusUserDiv").attr("class"); if (t != "" && t != null) { var n = t.replace("statusUserDiv ", ""); $(this).find(".app-header-icon").attr("class", "app-header-icon statusUserDiv2 margin-right-sml " + n) } if ($(this).css("display") == "block") { openWSE.SetAppIconActive(this) } }) } } } function y(e) { var t = true; var n = ""; if (typeof Getworkspace == "function") { n = Getworkspace() } for (var r = 0; r < e.length; r++) { var i = e[r].split("~|~"); if (i.length == 2) { var s = i[0]; var o = i[1]; var u = $(".app-main-holder[data-appid='app-ChatClient-" + s + "']"); var a = $(".app-min-bar[data-appid='app-ChatClient-" + s + "']"); var f = ""; if (u.closest(".workspace-holder").length > 0) { f = u.closest(".workspace-holder").attr("id").replace("MainContent_", "") } if (a.length > 0) { if (!a.hasClass("chatisNew")) { a.addClass("chatisNew"); if (!$(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().hasClass("chatisNew") && !t) { $(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().addClass("chatisNew") } N(o) } } else if (u.length > 0 && u.css("display") == "block") { if (!u.find(".app-head").hasClass("chatisNew") && (!u.hasClass("selected") || n != f)) { u.find(".app-head").addClass("chatisNew"); if (!$(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().hasClass("chatisNew") && (!t || n != f)) { $(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().addClass("chatisNew") } N(o) } } else { var l = true; if ($(".iFrame-chat").length > 0) { l = false } if (l) { if (!$(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().hasClass("chatisNew")) { $(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().addClass("chatisNew"); N(o) } } } } } } function b(e, n) { if ($("#app-ChatClient-" + n).find(".app-head").hasClass("chatisNew")) { $("#app-ChatClient-" + n).find(".app-head").removeClass("chatisNew"); t = 1 } if ($(".ChatUserNotSelected[chat-username='" + e + "']").hasClass("chatisNew")) { $(".ChatUserNotSelected[chat-username='" + e + "']").removeClass("chatisNew"); t = 1 } } function w(e) { try { S(e); if (document.title != n) { t = 1; document.title = n } } catch (r) { delete r } } function E(e) { var t = e; if (t != null) { t = t.replace(/"/gi, "'"); var n = document.getElementById("currentStatus"); if (n != null) { if (n.innerHTML.replace(/"/gi, "'") != t && t != "") { n.innerHTML = t } } } } function S(e) { if (!u) { u = true; $.ajax({ type: "POST", url: r + "/CallUpdate", data: '{ "userto": "' + e + '" }', contentType: "application/json; charset=utf-8", success: function (r) { if (!chatClient.ConvertBitToBoolean(r.d)) { b(e); if (document.title != n) { t = 1; document.title = n } } u = false }, error: function (e) { u = false } }) } } function x(e) { if (!f) { f = true; $.ajax({ type: "POST", url: r + "/CallUpdateStatus", data: '{ "status": "' + e + '" }', contentType: "application/json; charset=utf-8", success: function (e) { var t = e.d; t = t.replace(/"/gi, "'"); var n = document.getElementById("currentStatus"); if (n.innerHTML.replace(/"/gi, "'") != t && t != "") n.innerHTML = t; f = false }, error: function (e) { f = false } }) } } function T() { if (!a) { a = true; $.ajax({ type: "POST", url: r + "/CallWindowFocus", data: "{}", contentType: "application/json; charset=utf-8", success: function (e) { var t = e.d; t = t.replace(/"/gi, "'"); var n = document.getElementById("currentStatus"); if (n.innerHTML.replace(/"/gi, "'") != t && t != "") n.innerHTML = t; a = false }, error: function (e) { a = false } }) } } function N(r) { C(); e = setInterval(function () { if (t == 1) { document.title = n; clearInterval(e) } else { if (document.title != r + " Says...") document.title = r + " Says..."; else document.title = n } }, 1500) } function C() { if (chatClient.ConvertBitToBoolean($("#hf_chatsound").val())) { $.playSound(h() + "ChatClient/Notifications/notification.wav") } } function k() { $.ajax({ type: "POST", url: r + "/CallUserList", data: '{ "currstatus": "' + $("#span_currStatus").html() + '","isPostBack": "1" }', contentType: "application/json; charset=utf-8", dataType: "json", cache: false, success: function (e) { if (e.d[0] != null) E(e.d[0]); if (e.d[1] != null) g(e.d[1]); if (e.d[2] != null) { y(e.d[2]) } if (!s) { $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") } }, error: function (e) { if (!s) { $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") } } }) } var e; var t = 0; var n = document.title; var r = "ChatClient/ChatService.asmx"; var i = 1; var s = true; var o = false; var u = false; var a = false; var f = false; $(document.body).on("click", "#container, #container-logo, .workspace-holder", function () { if ($("#ul_StatusList").css("display") == "block" || $("#ul_StatusList").css("display") == "") { $("#ul_StatusList").fadeOut(openWSE_Config.animationSpeed) } if ($("#span_currStatus").text() == "Away") { T() } }); $(document.body).on("click", ".chat-modal", function () { var e = $(this).attr("chat-username"); var t = $(this).attr("data-appid"); b(e, t) }); $(document.body).on("click", ".ChatUserNotSelected, .ChatUserSelected", function () { var e = $(this).find("span").html(); var t = $(this).attr("chat-username"); var n = $(this).find("span").attr("chat-userid"); try { if ($("#workspace_holder").length > 0 && openWSE.IsComplexWorkspaceMode()) { p(t, n, e) } else { openWSE.PopOutFrame(this, h() + "ChatClient/ChatWindow.html?user=" + t) } } catch (r) { appRemote_Config.remoteId = t; appRemote_Config.remoteName = e; appRemote.UpdateURL(); d(t) } b(t, n); return false }); $(document.body).on("click", ".updatestatus, .chatstatus_mid", function () { var e; if ($(this).find("a").length > 0) { e = $(this).find("a").attr("href").split("#")[1] } else { e = $(this).attr("href").split("#")[1] } if (e != "#" && e != "") { x(e) } var t = document.getElementById("ul_StatusList"); if (t.style.display == "none") $("#ul_StatusList").fadeIn(150); else $("#ul_StatusList").fadeOut(150); return false }); $.extend({ playSound: function () { var e = arguments[0]; var t = '<div style="visibility:hidden"><audio autoplay="autoplay"><source src="' + e + '" type="audio/x-wav" />'; t += '<embed hidden="true" autostart="true" loop="false" src="' + e + '" /></audio></div>'; $("#playSound").html(t) } }); return { init: l, ConvertBitToBoolean: c, BuildChatWindow: p, BuildChatWindowMobile: d, getUsersOnline: v, updateChatUsers: m, updateUserList: g, GetNewChatsworkspace: y, RemoveIsNew: b, displayMessageNoti: w, getCurrStatus: E, updateisNewChat: S, updateCurrStatus: x, updateWindowFocus: T, flashTitle: N, playSound: C, notificationCleared: t, currTitle: n, updateChatUsers_NoLoop: k } }(); $(document).ready(function () { Array.prototype.indexOf; if (!Array.prototype.indexOf) { Array.prototype.indexOf = function (e, t) { for (var n = t || 0, r = this.length; n < r; n++) { if (this[n] === e) { return n } } return -1 } } $("body").append('<span id="playSound"></span>'); chatClient.init(); chatClient.getCurrStatus(); chatClient.updateChatUsers() });