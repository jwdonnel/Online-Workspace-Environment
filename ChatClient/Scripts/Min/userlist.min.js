var chatClient = function () { function t() { b = a() + "ChatClient/ChatService.asmx" } function e(t) { var e = $.trim(t.toString().toLowerCase()); return "true" != e && "false" != e && "0" != e && "1" != e && "" != e ? !0 : "1" == e || "true" == e || "" == e ? !0 : "0" == e || "false" == e ? !1 : !1 } function a() { return "object" == typeof openWSE || "function" == typeof openWSE ? openWSE.siteRoot() : "" } function n(t, e, a) { var n = openWSE.Getworkspace(), r = "app-ChatClient-" + e; if (0 == $(".app-main-holder[data-appid='" + r + "']").length) { var p = $(".ChatUserNotSelected[chat-username='" + t + "']").find(".statusUserDiv").attr("class"); "" != p && null != p && void 0 != p && (p = p.replace("statusUserDiv ", "")); var l = "app-main-style1"; null != openWSE_Config && (l = "app-main-style" + openWSE_Config.appStyle.toLowerCase().replace("style_", "")); var c = "<div data-appid='" + r + "' chat-username='" + t + "' class='app-main-holder app-main chat-modal " + l + "' style='display: none; min-height: 425px; min-width: 315px;'>"; "app-main-style1" == l ? (c += s(r, t), c += i(a, p), c += o()) : "app-main-style2" == l ? (c += o(), c += s(r, t), c += i(a, p)) : "app-main-style3" == l && (c += o(), c += s(r, t), c += i(a, p)), c += "</div>", $("#MainContent_" + n).append(c) } if ($(".app-main-holder[data-appid='" + r + "']").length > 0) { openWSE.ApplyAppDragResize(); var d = $(".app-main-holder[data-appid='" + r + "']"); openWSE.LoadApp(d, n), 0 == d.hasClass("active") && d.addClass("active"), m(t) } } function s(t, e) { var a = ""; if (openWSE_Config && "Style_3" == openWSE_Config.appStyle && (a += "<div class='app-head-hover-button'></div>"), a += "<div class='app-head-button-holder'>", openWSE_Config && "Style_3" == openWSE_Config.appStyle && (a += "<a href='#" + t + "' class='move-button-app' title='Move app'><span></span></a>"), a += "<a href='#" + t + "' class='options-button-app' title='View app options'><span></span></a>", a += "<div class='app-popup-inner-app'>", a += "<table><tbody><tr><td valign='top'><h3>App Options</h3><div class='clear-space-five'></div><ul>", a += "<li onclick='openWSE.ReloadApp(this)' title='Refresh'><a href='#" + t + "' class='reload-button-app'></a><span>Refresh</span></li>", a += "<li onclick=\"openWSE.PopOutFrame(this,'ExternalAppHolder.aspx?chatuser=" + e + "')\" title='Pop Out'><a href='#" + t + "' class='popout-button-app'></a><span>Pop out</span></li>", a += "<li onclick='openWSE.AboutApp(this)' title='About App'><div class='about-app'></div><span>About</span></li></ul></td></tr>", $("#ddl_WorkspaceSelector").length > 0) { a += "<tr><td><div class='clear-space'></div><span class='workspace-selector-app-option'>Workspace</span>", a += "<select class='app-options-workspace-switch'>"; for (var n = $("#ddl_WorkspaceSelector").find(".dropdown-db-selector").find(".workspace-selection-item").length, s = 0; n > s; s++) a += "<option value='" + (s + 1).toString() + "'>" + (s + 1).toString() + "</option>"; a += "</select></td></tr>" } return a += "</tbody></table></div>", a += "<a href='#" + t + "' class='exit-button-app' title='Close'><span></span></a>", a += "<a href='#" + t + "' class='maximize-button-app' title='Maximize'><span></span></a>", a += "<a href='#" + t + "' class='minimize-button-app' title='Minimize'><span></span></a></div>" } function i(t, e) { var a = "<div class='app-head app-head-dblclick'>"; return a += "<div class='app-header-icon statusUserDiv2 margin-right-sml " + e + "'></div>", a += "<span class='app-title'>" + t + "</span></div>" } function o() { return "<div class='app-body'></div>" } function r(t) { $("#pnl_icons, #pnl_chat_users").hide(), $("#pnl_chat_popup").fadeIn(150), $(".iFrame-chat").length > 0 && $(".iFrame-chat").each(function () { $(this).remove() }), $("#pnl_chat_popup").append("<iframe class='iFrame-chat' src='" + a() + "ChatClient/ChatWindow.html?user=" + t + "' width='100%' frameborder='0'></iframe>"), m(t), $(window).resize() } function p() { var t; return t = $get("chattersOnline").innerHTML } function l() { W || (W = !0, $.ajax({ type: "POST", url: b + "/CallUserList", data: '{ "currstatus": "' + $("#span_currStatus").html() + '","isPostBack": "' + U + '" }', contentType: "application/json; charset=utf-8", dataType: "json", cache: !1, success: function (t) { null != t.d[0] && f(t.d[0]), null != t.d[1] && c(t.d[1]), null != t.d[2] && d(t.d[2]), U = 0, W = !1, k || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none"), l() }, error: function () { U = 0, W = !1, k || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none"), l() } })) } function c(t) { if (null != document.getElementById("chatuserlist")) { var e = document.getElementById("chatuserlist").innerHTML; if (e = e.replace(/"/g, "'"), e = e.replace(/ ChatUserSelected/g, ""), e = e.replace(/ChatUserSelected /g, ""), e = e.replace(/ chatisNew/g, ""), e = e.replace(/chatisNew/g, ""), e = e.replace(/;/g, ""), e = e.replace(/%2F/g, ""), "" != t && t.toLowerCase() != e.toLowerCase()) { $("#chatuserlist").html(t); var a = $(".listofusers li").size(), n = document.getElementById("chatusers_none"); if ("0" != a || null != n && void 0 != n) { var s = document.getElementById("chatuserlist"); s.scrollTop = s.scrollHeight; var i = p(); "none" == i && (i = "no users "), $("#header-total-online").html(i), $(".chat-modal").each(function () { var t = $(this).attr("data-appid"); t = t.replace("app-ChatClient-", ""); var e = $(".ChatUserNotSelected").find("span[chat-userid='" + t + "']").parent().find(".statusUserDiv").attr("class"); if ("" != e && null != e) { var a = e.replace("statusUserDiv ", ""); $(this).find(".app-header-icon").attr("class", "app-header-icon statusUserDiv2 margin-right-sml " + a) } "block" == $(this).css("display") && openWSE.SetAppIconActive(this) }) } else $("#header-total-online").html("0"), $("#chatuserlist").html("<div id='chatusers_none'>No users available</div>") } } } function d(t) { var e = !0, a = ""; "function" == typeof Getworkspace && (a = Getworkspace()); for (var n = 0; n < t.length; n++) { var s = t[n].split("~|~"); if (2 == s.length) { var i = s[0], o = s[1], r = $(".app-main-holder[data-appid='app-ChatClient-" + i + "']"), p = $(".app-min-bar[data-appid='app-ChatClient-" + i + "']"), l = ""; if (r.closest(".workspace-holder").length > 0 && (l = r.closest(".workspace-holder").attr("id").replace("MainContent_", "")), p.length > 0) p.hasClass("chatisNew") || (p.addClass("chatisNew"), $(".ChatUserNotSelected").find("span[chat-userid='" + i + "']").parent().hasClass("chatisNew") || e || $(".ChatUserNotSelected").find("span[chat-userid='" + i + "']").parent().addClass("chatisNew"), S(o)); else if (r.length > 0 && "block" == r.css("display")) r.find(".app-head").hasClass("chatisNew") || r.hasClass("selected") && a == l || (r.find(".app-head").addClass("chatisNew"), $(".ChatUserNotSelected").find("span[chat-userid='" + i + "']").parent().hasClass("chatisNew") || e && a == l || $(".ChatUserNotSelected").find("span[chat-userid='" + i + "']").parent().addClass("chatisNew"), S(o)); else { var c = !0; $(".iFrame-chat").length > 0 && (c = !1), c && ($(".ChatUserNotSelected").find("span[chat-userid='" + i + "']").parent().hasClass("chatisNew") || ($(".ChatUserNotSelected").find("span[chat-userid='" + i + "']").parent().addClass("chatisNew"), S(o))) } } } } function u(t, e) { $(".app-main-holder[data-appid='" + e + "']").find(".app-head").hasClass("chatisNew") && ($(".app-main-holder[data-appid='" + e + "']").find(".app-head").removeClass("chatisNew"), N = 1), $(".ChatUserNotSelected[chat-username='" + t + "']").hasClass("chatisNew") && ($(".ChatUserNotSelected[chat-username='" + t + "']").removeClass("chatisNew"), N = 1) } function h(t) { try { m(t), document.title != _ && (N = 1, document.title = _) } catch (e) { delete e } } function f(t) { var e = t; if (null != e) { e = e.replace(/"/gi, "'"); var a = document.getElementById("currentStatus"); null != a && a.innerHTML.replace(/"/gi, "'") != e && "" != e && (a.innerHTML = e) } } function m(t) { E || (E = !0, $.ajax({ type: "POST", url: b + "/CallUpdate", data: '{ "userto": "' + t + '" }', contentType: "application/json; charset=utf-8", success: function (e) { chatClient.ConvertBitToBoolean(e.d) || (u(t), document.title != _ && (N = 1, document.title = _)), E = !1 }, error: function () { E = !1 } })) } function C(t) { L || (L = !0, $.ajax({ type: "POST", url: b + "/CallUpdateStatus", data: '{ "status": "' + t + '" }', contentType: "application/json; charset=utf-8", success: function (t) { var e = t.d; e = e.replace(/"/gi, "'"); var a = document.getElementById("currentStatus"); a.innerHTML.replace(/"/gi, "'") != e && "" != e && (a.innerHTML = e), L = !1 }, error: function () { L = !1 } })) } function v() { T || (T = !0, $.ajax({ type: "POST", url: b + "/CallWindowFocus", data: "{}", contentType: "application/json; charset=utf-8", success: function (t) { var e = t.d; e = e.replace(/"/gi, "'"); var a = document.getElementById("currentStatus"); a.innerHTML.replace(/"/gi, "'") != e && "" != e && (a.innerHTML = e), T = !1 }, error: function () { T = !1 } })) } function S(t) { y(), w = setInterval(function () { 1 == N ? (document.title = _, clearInterval(w)) : document.title = document.title != t + " Says..." ? t + " Says..." : _ }, 1500) } function y() { chatClient.ConvertBitToBoolean($("#hf_chatsound").val()) && $.playSound(a() + "ChatClient/Notifications/notification.wav") } function g() { $.ajax({ type: "POST", url: b + "/CallUserList", data: '{ "currstatus": "' + $("#span_currStatus").html() + '","isPostBack": "1" }', contentType: "application/json; charset=utf-8", dataType: "json", cache: !1, success: function (t) { null != t.d[0] && f(t.d[0]), null != t.d[1] && c(t.d[1]), null != t.d[2] && d(t.d[2]), k || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") }, error: function () { k || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") } }) } var w, N = 0, _ = document.title, b = "ChatClient/ChatService.asmx", U = 1, k = !0, W = !1, E = !1, T = !1, L = !1; return $(document.body).on("click", "#container, #container-logo, .workspace-holder", function () { ("block" == $("#ul_StatusList").css("display") || "" == $("#ul_StatusList").css("display")) && $("#ul_StatusList").fadeOut(openWSE_Config.animationSpeed), "Away" == $("#span_currStatus").text() && v() }), $(document.body).on("click", ".chat-modal", function () { var t = $(this).attr("chat-username"), e = $(this).attr("data-appid"); u(t, e) }), $(document.body).on("click", ".ChatUserNotSelected, .ChatUserSelected", function () { var t = $(this).find("span").html(), e = $(this).attr("chat-username"), s = $(this).find("span").attr("chat-userid"); try { $("#workspace_holder").length > 0 && openWSE.IsComplexWorkspaceMode() ? n(e, s, t) : openWSE.PopOutFrame(this, a() + "ChatClient/ChatWindow.html?user=" + e) } catch (i) { appRemote_Config.categoryId = "chatClient", appRemote_Config.categoryName = "userSelect", appRemote_Config.remoteId = e, appRemote_Config.remoteName = t, appRemote.UpdateURL(), r(e) } return u(e, s), !1 }), $(document.body).on("click", ".updatestatus, .chatstatus_mid", function () { var t; t = $(this).find("a").length > 0 ? $(this).find("a").attr("href").split("#")[1] : $(this).attr("href").split("#")[1], "#" != t && "" != t && C(t); var e = document.getElementById("ul_StatusList"); return "none" == e.style.display ? $("#ul_StatusList").fadeIn(150) : $("#ul_StatusList").fadeOut(150), !1 }), $.extend({ playSound: function () { var t = arguments[0], e = '<div style="visibility:hidden"><audio autoplay="autoplay"><source src="' + t + '" type="audio/x-wav" />'; e += '<embed hidden="true" autostart="true" loop="false" src="' + t + '" /></audio></div>', $("#playSound").html(e) } }), { init: t, ConvertBitToBoolean: e, BuildChatWindow: n, BuildChatWindowMobile: r, getUsersOnline: p, updateChatUsers: l, updateUserList: c, GetNewChatsworkspace: d, RemoveIsNew: u, displayMessageNoti: h, getCurrStatus: f, updateisNewChat: m, updateCurrStatus: C, updateWindowFocus: v, flashTitle: S, playSound: y, notificationCleared: N, currTitle: _, updateChatUsers_NoLoop: g } }(); $(document).ready(function () { Array.prototype.indexOf, Array.prototype.indexOf || (Array.prototype.indexOf = function (t, e) { for (var a = e || 0, n = this.length; n > a; a++) if (this[a] === t) return a; return -1 }), $("body").append('<span id="playSound"></span>'), chatClient.init(), chatClient.getCurrStatus(), chatClient.updateChatUsers() });