// -----------------------------------------------------------------------------------
//
//	Chat Client v3.3
//	by John Donnelly
//	Last Modification: 5/30/2017
//
//	Licensed under the Creative Commons Attribution 2.5 License - http://creativecommons.org/licenses/by/2.5/
//  	- Free for use in both personal and commercial projects
//		- Attribution requires leaving author name, author link, and the license info intact.
//
// -----------------------------------------------------------------------------------
var chatClient = function () { function t() { return "object" == typeof openWSE || "function" == typeof openWSE ? openWSE.siteRoot() : "" } function e(t, e, s) { var i = openWSE.Getworkspace(), o = "app-ChatClient-" + e; if (0 == $(".app-main-holder[data-appid='" + o + "']").length) { var l = $(".ChatUserNotSelected[chat-username='" + t + "']").find(".statusUserDiv").attr("class"); "" != l && null != l && void 0 != l && (l = l.replace("statusUserDiv ", "")); var p = "app-main-style1"; null != openWSE_Config && (p = "app-main-style" + openWSE_Config.appStyle.toLowerCase().replace("style_", "")); var r = "<div data-appid='" + o + "' chat-username='" + t + "' class='app-main-holder app-main chat-modal " + p + "' style='display: none; min-height: 425px; min-width: 315px;'>"; "app-main-style1" == p ? (r += a(o, t), r += n(s, l), r += "<div class='app-body'></div>") : "app-main-style2" == p ? (r += "<div class='app-body'></div>", r += a(o, t), r += n(s, l)) : "app-main-style3" == p && (r += "<div class='app-body'></div>", r += a(o, t), r += n(s, l)), r += "</div>", $("#MainContent_" + i).append(r) } if ($(".app-main-holder[data-appid='" + o + "']").length > 0) { openWSE.ApplyAppDragResize(); var d = $(".app-main-holder[data-appid='" + o + "']"); openWSE.LoadApp(d, i), 0 == d.hasClass("active") && d.addClass("active"), c(t) } } function a(t, e) { var a = ""; if (openWSE_Config && "Style_3" == openWSE_Config.appStyle && (a += "<div class='app-head-hover-button'></div>"), a += "<div class='app-head-button-holder'>", openWSE_Config && "Style_3" == openWSE_Config.appStyle && (a += "<a href='#" + t + "' class='move-button-app' title='Move app'><span></span></a>"), a += "<a href='#" + t + "' class='options-button-app' title='View app options'><span></span></a>", a += "<div class='app-popup-inner-app'>", a += "<div class='app-popup-inner-app-header-text'>App Options</div><ul>", a += "<li onclick='openWSE.ReloadApp(this)' title='Refresh'><a href='#" + t + "' class='reload-button-app'></a><span>Refresh</span></li>", a += "<li onclick=\"openWSE.PopOutFrame(this,'ExternalAppHolder.aspx?chatuser=" + e + "')\" title='Pop Out'><a href='#" + t + "' class='popout-button-app'></a><span>Pop out</span></li>", a += "<li onclick='openWSE.AboutApp(this)' title='About App'><div class='about-app'></div><span>About</span></li></ul><div class='clear'></div>", $("#ddl_WorkspaceSelector").length > 0) { a += "<div class='pad-all'><span class='workspace-selector-app-option'>Workspace</span>", a += "<select class='app-options-workspace-switch'>"; for (var n = $("#ddl_WorkspaceSelector").find(".dropdown-db-selector").find(".workspace-selection-item").length, s = 0; s < n; s++) a += "<option value='" + (s + 1).toString() + "'>" + (s + 1).toString() + "</option>"; a += "</select></div>" } return a += "</div>", a += "<a href='#" + t + "' class='exit-button-app' title='Close'><span></span></a>", a += "<a href='#" + t + "' class='maximize-button-app' title='Maximize'><span></span></a>", a += "<a href='#" + t + "' class='minimize-button-app' title='Minimize'><span></span></a></div>" } function n(t, e) { var a = "<div class='app-head app-head-dblclick'>"; return a += "<div class='app-header-icon statusUserDiv2 margin-right-sml " + e + "'></div>", a += "<span class='app-title'>" + t + "</span></div>" } function s() { return $get("chattersOnline").innerHTML } function i() { b || (b = !0, m(S + "/CallUserList", '{ "currstatus": "' + $("#span_currStatus").html() + '","isPostBack": "' + g + '" }', { cache: !1 }, function (t) { null != t.d[0] && r(t.d[0]), null != t.d[1] && o(t.d[1]), null != t.d[2] && l(t.d[2]), g = 0, b = !1, w || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none"), i() }, function (t) { g = 0, b = !1, w || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none"), i() })) } function o(t) { if (null != document.getElementById("chatuserlist")) { var e = document.getElementById("chatuserlist").innerHTML; if (e = e.replace(/"/g, "'"), e = e.replace(/ ChatUserSelected/g, ""), e = e.replace(/ChatUserSelected /g, ""), e = e.replace(/ chatisNew/g, ""), e = e.replace(/chatisNew/g, ""), e = e.replace(/;/g, ""), e = e.replace(/%2F/g, ""), "" != t && t.toLowerCase() != e.toLowerCase()) { $("#chatuserlist").html(t); var a = $(".listofusers li").length, n = document.getElementById("chatusers_none"); if ("0" != a || null != n && void 0 != n) { var i = document.getElementById("chatuserlist"); i.scrollTop = i.scrollHeight; var o = s(); "none" == o && (o = "no users "), $("#header-total-online").html(o), $(".chat-modal").each(function () { var t = $(this).attr("data-appid"); t = t.replace("app-ChatClient-", ""); var e = $(".ChatUserNotSelected").find("span[chat-userid='" + t + "']").parent().find(".statusUserDiv").attr("class"); if ("" != e && null != e) { var a = e.replace("statusUserDiv ", ""); $(this).find(".app-header-icon").attr("class", "app-header-icon statusUserDiv2 margin-right-sml " + a) } "block" == $(this).css("display") && openWSE.SetAppIconActive(this) }) } else $("#header-total-online").html("0"), $("#chatuserlist").html("<div id='chatusers_none'>No users available</div>") } } } function l(t) { var e = ""; "function" == typeof Getworkspace && (e = Getworkspace()); for (var a = 0; a < t.length; a++) { var n = t[a].split("~|~"); if (2 == n.length) { var s = n[0], i = n[1], o = $(".app-main-holder[data-appid='app-ChatClient-" + s + "']"), l = $(".app-min-bar[data-appid='app-ChatClient-" + s + "']"), p = ""; if (o.closest(".workspace-holder").length > 0 && (p = o.closest(".workspace-holder").attr("id").replace("MainContent_", "")), l.length > 0) l.hasClass("chatisNew") || (l.addClass("chatisNew"), $(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().hasClass("chatisNew"), h(i)); else if (o.length > 0 && "block" == o.css("display")) o.find(".app-head").hasClass("chatisNew") || o.hasClass("selected") && e == p || (o.find(".app-head").addClass("chatisNew"), $(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().hasClass("chatisNew") || e == p || $(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().addClass("chatisNew"), h(i)); else { var r = !0; $(".iFrame-chat").length > 0 && (r = !1), r && ($(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().hasClass("chatisNew") || ($(".ChatUserNotSelected").find("span[chat-userid='" + s + "']").parent().addClass("chatisNew"), h(i))) } } } } function p(t, e) { $(".app-main-holder[data-appid='" + e + "']").find(".app-head").hasClass("chatisNew") && ($(".app-main-holder[data-appid='" + e + "']").find(".app-head").removeClass("chatisNew"), v = 1), $(".ChatUserNotSelected[chat-username='" + t + "']").hasClass("chatisNew") && ($(".ChatUserNotSelected[chat-username='" + t + "']").removeClass("chatisNew"), v = 1) } function r(t) { var e = t; if (null != e) { e = e.replace(/"/gi, "'"); var a = document.getElementById("currentStatus"); null != a && a.innerHTML.replace(/"/gi, "'") != e && "" != e && (a.innerHTML = e) } } function c(t) { N || (N = !0, m(S + "/CallUpdate", '{ "userto": "' + t + '" }', null, function (e) { chatClient.ConvertBitToBoolean(e.d) || (p(t), document.title != y && (v = 1, document.title = y)), N = !1 }, function (t) { N = !1 })) } function d(t) { k || (k = !0, m(S + "/CallUpdateStatus", '{ "status": "' + t + '" }', null, function (t) { var e = t.d; e = e.replace(/"/gi, "'"); var a = document.getElementById("currentStatus"); a.innerHTML.replace(/"/gi, "'") != e && "" != e && (a.innerHTML = e), k = !1 }, function (t) { k = !1 })) } function u() { U || (U = !0, m(S + "/CallWindowFocus", "{ }", null, function (t) { var e = t.d; e = e.replace(/"/gi, "'"); var a = document.getElementById("currentStatus"); a.innerHTML.replace(/"/gi, "'") != e && "" != e && (a.innerHTML = e), U = !1 }, function (t) { U = !1 })) } function h(t) { f(), C = setInterval(function () { 1 == v ? (document.title = y, clearInterval(C)) : document.title != t + " Says..." ? document.title = t + " Says..." : document.title = y }, 1500) } function f() { chatClient.ConvertBitToBoolean($("#hf_chatsound").val()) && $.playSound(t() + "ChatClient/Notifications/notification.wav") } function m(e, a, n, s, i, o) { if (e) { -1 === e.indexOf("http") && -1 === e.indexOf("www.") && -1 === e.indexOf("//") && (e = t() + e); var l = { url: e }; a && (l.data = a), n || (n = { dataType: "json", type: "POST", contentType: "application/json; charset=utf-8" }), l.dataType = n.dataType ? n.dataType : "json", l.type = n.type ? n.type : "POST", l.contentType = n.contentType ? n.contentType : "application/json; charset=utf-8", null !== n.dataFilter && void 0 !== n.dataFilter && (l.dataFilter = n.dataFilter), null !== n.cache && void 0 !== n.cache && (l.cache = n.cache), null !== n.async && void 0 !== n.async && (l.async = n.async), null !== n.processData && void 0 !== n.processData && (l.processData = n.processData), s && "function" == typeof s && (l.success = s), l.error = i && "function" == typeof i ? i : function (t) { loadingPopup.RemoveMessage(), t && t.statusText && "OK" !== t.statusText && openWSE.AlertWindow(t) }, o && "function" == typeof o && (l.complete = o), $.ajax(l) } } var C, v = 0, y = document.title, S = "ChatClient/ChatService.asmx", g = 1, w = !0, b = !1, N = !1, U = !1, k = !1; return $(document.body).on("click", "#main_container, #container-logo, .workspace-holder", function () { "block" != $("#ul_StatusList").css("display") && "" != $("#ul_StatusList").css("display") || $("#ul_StatusList").fadeOut(openWSE_Config.animationSpeed), "Away" == $("#span_currStatus").text() && u() }), $(document.body).on("click", ".chat-modal", function () { p($(this).attr("chat-username"), $(this).attr("data-appid")) }), $(document.body).on("click", ".ChatUserNotSelected, .ChatUserSelected", function () { var a = $(this).find("span").html(), n = $(this).attr("chat-username"), s = $(this).find("span").attr("chat-userid"); return 0 === $(".app-remote-container").length ? $("#workspace_holder").length > 0 && openWSE.IsComplexWorkspaceMode() ? e(n, s, a) : openWSE.PopOutFrame(this, t() + "ChatClient/ChatWindow.html?user=" + n) : window.location.hash = "#?tab=Chat_tab&id=" + n + "&fullname=" + a, p(n, s), !1 }), $(document.body).on("click", ".updatestatus, .chatstatus_mid", function () { var t; return "#" != (t = $(this).find("a").length > 0 ? $(this).find("a").attr("href").split("#")[1] : $(this).attr("href").split("#")[1]) && "" != t && d(t), "none" == document.getElementById("ul_StatusList").style.display ? $("#ul_StatusList").fadeIn(150) : $("#ul_StatusList").fadeOut(150), !1 }), $.extend({ playSound: function () { var t = arguments[0], e = '<div style="visibility:hidden"><audio autoplay="autoplay"><source src="' + t + '" type="audio/x-wav" />'; e += '<embed hidden="true" autostart="true" loop="false" src="' + t + '" /></audio></div>', $("#playSound").html(e) } }), { init: function () { S = t() + "ChatClient/ChatService.asmx" }, ConvertBitToBoolean: function (t) { var e = $.trim(t.toString().toLowerCase()); return "true" != e && "false" != e && "0" != e && "1" != e && "" != e || "1" == e || "true" == e || "" == e }, BuildChatWindow: e, BuildChatWindowMobile: function (e) { $(".iFrame-chat").length > 0 && $(".iFrame-chat").each(function () { $(this).remove() }), $("#pnlContent_ChatPopup").append("<iframe class='iFrame-chat' src='" + t() + "ChatClient/ChatWindow.html?user=" + e + "' width='100%' frameborder='0'></iframe>"), c(e), $(window).resize() }, getUsersOnline: s, updateChatUsers: i, updateUserList: o, GetNewChatsworkspace: l, RemoveIsNew: p, displayMessageNoti: function (t) { try { c(t), document.title != y && (v = 1, document.title = y) } catch (t) { delete t } }, getCurrStatus: r, updateisNewChat: c, updateCurrStatus: d, updateWindowFocus: u, flashTitle: h, playSound: f, notificationCleared: v, currTitle: y, updateChatUsers_NoLoop: function () { m(S + "/CallUserList", '{ "currstatus": "' + $("#span_currStatus").html() + '","isPostBack": "1" }', { cache: !1 }, function (t) { null != t.d[0] && r(t.d[0]), null != t.d[1] && o(t.d[1]), null != t.d[2] && l(t.d[2]), w || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") }, function (t) { w || $(".ChatUserNotSelected, .ChatUserSelected").css("background-image", "none") }) } } }(); $(document).ready(function () { Array.prototype.indexOf, Array.prototype.indexOf || (Array.prototype.indexOf = function (t, e) { for (var a = e || 0, n = this.length; a < n; a++) if (this[a] === t) return a; return -1 }), $("body").append('<span id="playSound"></span>'), chatClient.init(), chatClient.getCurrStatus(), chatClient.updateChatUsers() });
